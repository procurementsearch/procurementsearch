@model SearchProcurement.Models.Agency
@{
  Layout = "~/Views/Shared/_Account.cshtml";
}

<div class="account-container">
  <img src="~/images/logo-100x100.png" alt="Procurement Search Logo">
  <h1>Your Organization Account</h1>
  <p>
    <a href="/Agency">Return to dashboard</a>
  </p>

  <form class="pure-form pure-form-aligned" id="account" method="POST" action="/Agency/MyAgencyPost">
  @Html.AntiForgeryToken()


    <div id="tabs">
      <ul>
        <li><a href="#about">About You</a></li>
        <li><a href="#contact">Contact Info</a></li>
        <li><a href="#departments">Departments &amp; Categories</a></li>
        <li><a href="#logo">Your Logo</a></li>
        <li><a href="#text">Instructional Text</a></li>
        <li><a href="#templates">Document &amp; Email Templates</a></li>
      </ul>

      <div id="about">
        <fieldset>
          <legend>About Your Organization</legend>

          <p class="attention">Basic information about your organization.</p>

          <div class="pure-control-group">
            <label asp-for="AgencyName"></label>
            <input asp-for="AgencyName" placeholder="" required data-parsley-errors-messages-disabled="true">
            <span class="pure-form-message-inline">This is a required field.</span>
          </div>

          <div class="pure-control-group">
            <label asp-for="AgencyUrl"></label>
            <input asp-for="AgencyUrl">
          </div>
        </fieldset>

        <fieldset>
          <legend>Mailing Address</legend>

          <p><i>What is your mailing address?</i></p>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.Address1">Address</label>
            <input asp-for="BillingAddress.Address1">
          </div>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.Address2">Street Address 2</label>
            <input asp-for="BillingAddress.Address2">
          </div>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.City">City</label>
            <input asp-for="BillingAddress.City">
          </div>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.State">State</label>
            <select asp-for="BillingAddress.State" asp-items="Model.States"></select>
          </div>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.Country">Country</label>
            <select asp-for="BillingAddress.Country" asp-items="Model.Countries"></select>
          </div>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.Postal">Zip/Postal Code</label>
            <input asp-for="BillingAddress.Postal">
          </div>

          <div class="pure-control-group">
            <label asp-for="BillingAddress.Phone"></label>
            <input asp-for="BillingAddress.Phone">
          </div>
        </fieldset>

        <fieldset>
          <legend>Physical Address</legend>

          <p><i>What is your Physical address?</i></p>

          <div class="pure-control-group">
            <label asp-for="ShippingAddress.Address1">Address</label>
            <input asp-for="ShippingAddress.Address1">
          </div>

          <div class="pure-control-group">
            <label asp-for="ShippingAddress.Address2">Street Address 2</label>
            <input asp-for="ShippingAddress.Address2">
          </div>

          <div class="pure-control-group">
            <label asp-for="ShippingAddress.City">City</label>
            <input asp-for="ShippingAddress.City">
          </div>

          <div class="pure-control-group">
            <label asp-for="ShippingAddress.State">State</label>
            <select asp-for="ShippingAddress.State" asp-items="Model.States"></select>
          </div>

          <div class="pure-control-group">
            <label asp-for="ShippingAddress.Country">Country</label>
            <select asp-for="ShippingAddress.Country" asp-items="Model.Countries"></select>
          </div>

          <div class="pure-control-group">
            <label asp-for="ShippingAddress.Postal">Zip/Postal Code</label>
            <input asp-for="ShippingAddress.Postal">
          </div>

          <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
          </div>
        </fieldset>

      </div>
      <div id="contact">

        <fieldset>
          <legend>Organization Contact Information</legend>

          <p class="attention">This is how vendors will reach your agency if they have general questions.</p>

          <div class="pure-control-group">
            <label asp-for="AgencyContactName"></label>
            <input asp-for="AgencyContactName" placeholder="">
          </div>

          <div class="pure-control-group">
            <label asp-for="AgencyContactEmail"></label>
            <input asp-for="AgencyContactEmail" placeholder="">
          </div>

          <div class="pure-control-group">
            <label asp-for="AgencyPhone"></label>
            <input asp-for="AgencyPhone" placeholder="">
          </div>

          <div class="pure-control-group">
            <label asp-for="AgencyFax"></label>
            <input asp-for="AgencyFax" placeholder="">
          </div>

          <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
          </div>
        </fieldset>

      </div>
      <div id="departments">

        <fieldset>
          <legend>Departments and Categories</legend>
          <p class="attention">These are the departments within your organizations, and the categories into which you can organize your solicitations.</p>


          <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
          </div>
        </fieldset>

      </div>
      <div id="logo">

        <fieldset>
          <legend>Your Logo</legend>

          <p class="attention">You can skip this if you don't have your logo handy.</p>

          <div class="pure-controls">
            <input type="button" class="pure-button pure-button-secondary" id="croppie_show" value="Upload Logo" />

            <div id="croppie_modal" style="display: none;">
              <a class="pure-button pure-button-secondary file-button">
                <span>Choose a file</span>
                <input type="file" id="croppie_upload" value="Choose a file" accept="image/*" />
              </a>
              <input type="button" class="pure-button pure-button-secondary croppie_save" value="Save Logo"/>
              <input type="button" class="pure-button pure-button-secondary" id="croppie_remove" value="Remove Logo"/>
              <div class="upload-msg">
                Upload a logo.  If you need to resize it, you can do so here.
              </div>
              <div class="upload-demo-wrap">
                <div id="croppie"></div>
              </div>
            </div>
            <div id="logo_preview" style="padding: 1em;"></div>
          </div>

          <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
          </div>
        </fieldset>

      </div>
      <div id="text">

        <fieldset>
          <legend>Organization Textual Information</legend>

          <p class="attention">Throughout Procurement Search, suppliers will see informational or instructional text about your agency.</p>

          <p><i><span class="attention">Agency Overview:</span> when a vendor is looking at your agency's overview page, which shows all of your open solicitations, they see this.</i></p>
          <textarea asp-for="AgencyOverviewText" placeholder="" class="pure-input-2-3"></textarea>
          <br><br>

          <p><i><span class="attention">About Your Agency:</span> on each of your solicitations, this text appears under "About your agency".</i></p>
          <textarea asp-for="AgencyAboutText" placeholder="" class="pure-input-2-3"></textarea>
          <br><br>

          <p><i><span class="attention">Default Action Steps:</span> each of your solicitations can have some optional instructions on what actions to take to participate in this solicitation.  While you can set that on a per-solicitation basis, this is the default that'll be affixed to each solicitation.</i></p>
          <textarea asp-for="AgencyDefaultActionSteps" placeholder="" class="pure-input-2-3"></textarea>
          <br><br>

          <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
        </fieldset>

      </div>
      <div id="templates">

        <fieldset>
          <legend>Your document and email templates</legend>
          <p class="attention">You may prepare and edit your automatically-generated documents and emails here.</p>

          <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
          </div>
        </fieldset>

      </div>
    </div>

  </form>

</div>



<script type="text/javascript">
$(function () {

  // create the tabs
  $( "#tabs" ).tabs();

  // And the text editors
  $( "#AgencyOverviewText, #AgencyAboutText, #AgencyDefaultActionSteps").trumbowyg();

  $('#account').parsley().on('field:validated', function() {
    if (this.validationResult === true) {
      this.$element.nextAll('.pure-form-message').first().removeClass('red');
    } else {
      this.$element.nextAll('.pure-form-message').first().addClass('red');
    }
  })
  .on('form:submit', function() {
    // return false; // Don't submit form for this demo
  });


  // Billing same as shipping checkbox
  $('#billing_same_as_shipping').change(function(){
    if( this.checked ) {
      $('#BillingAddress_Address1').val($('#ShippingAddress_Address1').val());
      $('#BillingAddress_Address2').val($('#ShippingAddress_Address2').val());
      $('#BillingAddress_City').val($('#ShippingAddress_City').val());
      $('#BillingAddress_State').val($('#ShippingAddress_State').val());
      $('#BillingAddress_Country').val($('#ShippingAddress_Country').val());
      $('#BillingAddress_Postal').val($('#ShippingAddress_Postal').val());
    }
  });



  // Set up croppie
  var $hid = $('#croppie_modal');
  var $hid_btn = $('#croppie_show');
  var $hid_remove = $('#logo_modal');
  var $uploadCrop = $('#croppie').croppie({
    viewport: {
      width: 175,
      height: 175,
      type: 'circle'
    },
    boundary: {
      width: 200,
      height: 200
    }
  });

  function readFile(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      reader.onload = function (e) {
        $uploadCrop.croppie('bind', {
          url: e.target.result
        }).then(function(){
          console.log('jQuery bind complete');
        });
      }
      reader.readAsDataURL(input.files[0]);
      // And save the logo name, for uploading
      $('input[name=logoName]').val(input.files[0].name);
    } else {
      swal("Sorry - you're browser doesn't support the FileReader API");
    }
  }

  $('#croppie_upload').on('change', function () { readFile(this); });
  $('.croppie_save').on('click', function (ev) {
    $uploadCrop.croppie('result', {
      type: 'base64',
      size: 'viewport'
    }).then(function (resp) {
      $('#logo_preview').empty().append('<p>Uploaded logo:</p><img src="' + resp + '">');
      $('input[name=logoData]').val(resp);
      $('input[name=removeOldLogo]').val('0');
      $hid.toggle();
      $hid_btn.toggle();
    });
  });

  $('#croppie_show').on('click', function () {
    $hid.toggle();
    $hid_btn.toggle();
    $uploadCrop.croppie('bind');
  });

  $('#croppie_remove').on('click', function(){
    $uploadCrop.croppie('bind', { url: ''});
    $('#logo_preview').empty();
    $('input[name=logoData]').val('');
    $('input[name=logoName]').val('');
    $('input[name=removeOldLogo]').val('1');
    $hid.toggle();
    $hid_btn.toggle();
  });

});

</script>
